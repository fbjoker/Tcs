<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<script type="text/javascript">
			//åœ°å›¾ç±»
			(function() {
				//åœ°å›¾æ„é€ å‡½æ•°
				//å‚æ•°  å®½  é«˜  èƒŒæ™¯è‰²
				function MapG(width, height, bgColor) {
					this.width = width;
					this.height = height;
					this.bgColor = bgColor;

				}
				//åˆ›å»ºdomå…ƒç´ ,æ·»åŠ åˆ°bodyä¸Š
				//å°†åˆ›å»ºçš„æ–¹æ³•æ·»åŠ åˆ°åŸå‹å¯¹è±¡ä¸Š,å…±äº«èµ„æº,èŠ‚çœç©ºé—´
				MapG.prototype.init = function() {
					//1.åˆ›å»ºåœ°å›¾div
					var divMap = document.createElement('div');
					//2.è®¾ç½®divå±æ€§
					divMap.style.width = this.width + 'px';
					divMap.style.height = this.height + 'px';
					divMap.style.background = this.bgColor;
					divMap.style.position = 'relative';
					divMap.id = 'divMap';
					//3.æ·»åŠ åˆ°body
					document.body.appendChild(divMap);
				}
				//æŠŠMapGå…¬å¸ƒåˆ°å¤–é¢
				window.MapG = MapG;
			}());

			//é£Ÿç‰©ç±»
			(function() {
				//é£Ÿç‰©æ•°ç»„
				var elements = [];
				//é£Ÿç‰©çš„æ„é€ å‡½æ•°
				// å‚æ•° å®½  é«˜  èƒŒæ™¯è‰²
				function Food(width, height, bgColor) {
					this.width = width;
					this.height = height;
					this.bgColor = bgColor;
					//é£Ÿç‰©åœ¨åœ°å›¾ä¸­çš„xåæ ‡çš„æ ¼æ•°
					this.x = 0;
					//é£Ÿç‰©åœ¨åœ°å›¾ä¸­çš„yåæ ‡çš„æ ¼æ•°
					this.y = 0;
				}
				//åˆ›å»ºdomå…ƒç´ ,æ·»åŠ åˆ°bodyä¸Š
				//å°†åˆ›å»ºçš„æ–¹æ³•æ·»åŠ åˆ°åŸå‹å¯¹è±¡ä¸Š,å…±äº«èµ„æº,èŠ‚çœç©ºé—´
				Food.prototype.init = function() {
					remove();
					//1.åˆ›å»ºdivå…ƒç´ 
					var divFood = document.createElement('div');
					//2.è®¾ç½®divå±æ€§
					divFood.style.width = this.width + 'px';
					divFood.style.height = this.height + 'px';
					divFood.style.background = this.bgColor;
					divFood.style.position = 'absolute';
					var divMap = document.getElementById('divMap');
					//ç”¨åœ°å›¾çš„å®½åº¦é™¤ä»¥é£Ÿç‰©çš„å®½åº¦å¾—åˆ°çš„æ˜¯æ ¼æ•°(800/20) = 40(æ ¼æ•°)
					//ç”Ÿæˆä¸€ä¸ª0-40çš„éšæœºæ•°,æœ€å¤§çš„æ ¼æ•°39,å‘ä¸‹å–æ•´,
					//å¾—åˆ°ä¸€ä¸ª0-39çš„éšæœºæ•´æ•°
					this.x = parseInt(Math.random() * (divMap.offsetWidth / this.width));
					this.y = parseInt(Math.random() * (divMap.offsetHeight / this.height));
					//æ ¼æ•°*å®½åº¦ = åƒç´ å€¼
					divFood.style.left = this.x * this.width + 'px';
					divFood.style.top = this.y * this.height + 'px';
					//3.æ·»åŠ åˆ°mapä¸­
					divMap.appendChild(divFood);
					//4
					elements.push(divFood);
				}
				//åˆ é™¤é£Ÿç‰©
				function remove() {
					for(var i = 0; i < elements.length; i++) {
						//ä»domä¸­åˆ é™¤
						elements[i].parentElement.removeChild(elements[i]);
						//æ¸…ç©ºæ•°ç»„
						elements.splice(i, 1);
					}
				}
				//æŠŠFoodå…¬å¸ƒåˆ°å¤–é¢
				window.Food = Food;
			}());

			//è›‡ğŸç±»
			(function() {
				//å­˜å‚¨è›‡èº«çš„ä¸‰ä¸ªdiv
				var elements = [];
				//è›‡çš„æ„é€ å‡½æ•°
				//å‚æ•°  å®½  é«˜    è›‡çš„æ–¹å‘
				function Snake(width, height, dir) {
					//åˆå§‹åŒ–è›‡çš„å±æ€§
					this.width = width;
					this.height = height;
					this.dir = dir;
					//è›‡çš„èº«ä½“,é»˜è®¤ä¸‰éƒ¨åˆ†,è›‡å¤´,è›‡èº«,è›‡å°¾
					this.snBody = [{
						x: 3,
						y: 2,
						bgColor: 'red'
					}, {
						x: 2,
						y: 2,
						bgColor: 'orange'
					}, {
						x: 1,
						y: 2,
						bgColor: 'orange'
					}];
				}
				Snake.prototype.init = function() {
					//åœ¨åˆ›å»ºæ–°è›‡ä¹‹å‰,å…ˆåˆ é™¤è€è›‡
					remove();
					//ç”±äºè›‡é»˜è®¤æ˜¯ä¸‰æ–­,åˆ›å»ºä¸‰ä¸ªdiv
					for(var i = 0; i < this.snBody.length; i++) {
						//åˆ›å»ºdiv
						var divBody = document.createElement('div');
						//è®¾ç½®divå±æ€§
						divBody.style.width = this.width + 'px';
						divBody.style.height = this.height + 'px';
						//é€šè¿‡éå†ä¾æ¬¡è·å–æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ (å¯¹è±¡)ä¸­çš„bgColorå±æ€§
						divBody.style.background = this.snBody[i].bgColor;
						divBody.style.position = 'absolute';
						divBody.style.left = (this.snBody[i].x * this.width) + 'px';
						divBody.style.top = (this.snBody[i].y * this.height) + 'px';
						//æ·»åŠ åˆ°mapä¸­
						//ä»domä¸­è·å–mapå…ƒç´ 
						var divMap = document.getElementById('divMap');
						//å°†åˆ›å»ºå¥½çš„æ¯ä¸ªè›‡éƒ¨åˆ†æ·»åŠ åˆ°åœ°å›¾ä¸Š
						divMap.appendChild(divBody);
						//æŠŠæ¯ä¸ªdivéƒ½æ’å…¥åˆ°æ•°ç»„ä¸­
						elements.push(divBody);
					}
					//					console.log(elements);
				}
				Snake.prototype.move = function() {
					//æŠŠè›‡ä¸­çš„åæ ‡ç»™è›‡å°¾,æŠŠè›‡å¤´çš„åæ ‡ç»™è›‡ä¸­
					for(var i = this.snBody.length - 1; i > 0; i--) {
						// this.snBody[2].x = this.snBody[2-1].x
						this.snBody[i].x = this.snBody[i - 1].x;
						this.snBody[i].y = this.snBody[i - 1].y;
					}
					//è®¾ç½®è›‡å¤´

					switch(this.dir) {
						case 'right':
							this.snBody[0].x += 1;
							break;
						case 'left':
							this.snBody[0].x -= 1;
							break;
						case 'top':
							this.snBody[0].y -= 1;
							break;
						case 'bottom':
							this.snBody[0].y += 1;
							break;
						default:
							break;
					}

				}
				//åˆ é™¤æ–¹æ³•
				function remove() {
					for(var i = elements.length - 1; i >= 0; i--) {
						//1.ä»documentåˆ é™¤mapåœ°å›¾ä¸Šè›‡èº«
						elements[i].parentElement.removeChild(elements[i]);
						//2.ä»æ•°ç»„ä¸­åˆ é™¤,æ¯æ¬¡åˆ é™¤è‡ªå·±
						elements.splice(i, 1);
					}
				}

				window.Snake = Snake;
			}());

			// æ¸¸æˆç±»
			(function() {
				var gameThis = null;
				var timer = null;
				//æ¸¸æˆæ„é€ å‡½æ•°
				function Game() {
					//å®ä¾‹åŒ–mapå¯¹è±¡
					this.mapG = new MapG(800, 600, '#ccc');

					//å®ä¾‹åŒ–foodå¯¹è±¡
					this.food = new Food(20, 20, 'green');

					//å®ä¾‹åŒ–è›‡å¯¹è±¡
					this.snake = new Snake(20, 20, 'right');
				}
				Game.prototype.init = function() {
					//å¯¹è±¡è°ƒç”¨åŸå‹ä¸­çš„initæ–¹æ³•
					this.mapG.init();
					//è°ƒç”¨initåˆå§‹åŒ–å‡½æ•°
					this.food.init();
					//
					this.snake.init();
				}
				Game.prototype.guize = function() {
					gameThis = this;
					timer = window.setInterval(function() {
						//è°ƒç”¨initåˆå§‹åŒ–å‡½æ•°
						gameThis.snake.init();
						//è°ƒç”¨ç§»åŠ¨æ–¹æ³•: æŠŠä¸‰æˆªçš„åæ ‡å€¼é‡æ–°è®¾ç½®
						gameThis.snake.move();

						//è›‡å¤´æ’å¢™æ­»
						if(gameThis.snake.snBody[0].x < -1 || gameThis.snake.snBody[0].x > (gameThis.mapG.width / gameThis.snake.width) || gameThis.snake.snBody[0].y < -1 || gameThis.snake.snBody[0].y > (gameThis.mapG.height / gameThis.snake.height)) {
							//åœæ­¢å®šæ—¶å™¨
							clearInterval(timer);
						}

						//åƒé£Ÿç‰©é•¿å°¾å·´
						//						å½“é£Ÿç‰©çš„xå’Œyåæ ‡å’Œé£Ÿç‰©çš„xyåæ ‡å®Œå…¨ç›¸ç­‰çš„æ—¶å€™,æ¶¨å°¾å·´,ç”Ÿæˆæ–°é£Ÿç‰©
						if(gameThis.snake.snBody[0].x == gameThis.food.x && gameThis.snake.snBody[0].y == gameThis.food.y) {
							//1.ç”Ÿæˆæ–°é£Ÿç‰©
							gameThis.food.init();
							//2.é•¿å°¾å·´
							var obj = {
								x: gameThis.snake.snBody[gameThis.snake.snBody.length-1].x,
								y: gameThis.snake.snBody[gameThis.snake.snBody.length-1].y,
								bgColor: 'orange'
							};
							//å°†è›‡æ–°å¢çš„è›‡å°¾æ·»åŠ åˆ°è›‡èº«é‡Œ
							gameThis.snake.snBody.push(obj);
							
						}
					}, 100);

					//é”®ç›˜æŒ‰ä¸‹äº‹ä»¶
					document.onkeydown = function(e) {
						switch(e.keyCode) {
							case 37:
								gameThis.snake.dir = 'left';
								break;
							case 38:
								gameThis.snake.dir = 'top';
								break;
							case 39:
								gameThis.snake.dir = 'right';
								break;
							case 40:
								gameThis.snake.dir = 'bottom';
								break;
							default:
								break;
						}
					}
				}
				window.Game = Game;
			}());

			//			//å®ä¾‹åŒ–mapå¯¹è±¡
			//			var mapG = new MapG(800, 600, '#ccc');
			//
			//			//å¯¹è±¡è°ƒç”¨åŸå‹ä¸­çš„initæ–¹æ³•
			//			mapG.init();
			//			//å®ä¾‹åŒ–foodå¯¹è±¡
			//			var food = new Food(20, 20, 'green');
			//			//è°ƒç”¨initåˆå§‹åŒ–å‡½æ•°
			//			food.init();
			//			//å®ä¾‹åŒ–è›‡å¯¹è±¡
			//			var snake = new Snake(20, 20, 'right');
			//
			//			setInterval(function() {
			//				//è°ƒç”¨initåˆå§‹åŒ–å‡½æ•°
			//				snake.init();
			//				//è°ƒç”¨ç§»åŠ¨æ–¹æ³•: æŠŠä¸‰æˆªçš„åæ ‡å€¼é‡æ–°è®¾ç½®
			//				snake.move();
			//			}, 100);
			//å®ä¾‹åŒ–æ¸¸æˆ
			var game = new Game();
			game.init();
			game.guize();
		</script>
	</body>

</html>